var Tags;(function(n){var t=function(){function n(){this.prefilled=null,this.CapitalizeFirstLetter=!1,this.preventSubmitOnEnter=!0,this.isClearInputOnEsc=!0,this.typeahead=!1,this.typeaheadAjaxSource=null,this.typeaheadAjaxPolling=!1,this.typeaheadDelegate=null,this.typeaheadOverrides=null,this.typeaheadSource=null,this.AjaxPush=null,this.delimeters=[44,188,13,9],this.backspace=[8],this.maxTags=0,this.hiddenTagListName=null,this.hiddenTagListId=null,this.deleteTagsOnBackspace=!0,this.tagCloseIcon="x",this.tagClass="",this.validator=null}return n}(),i=function(){function n(){this.instanceSelectHandler=null,this.selectedClass="selected",this.select=null,"typeahead"in jQuery.fn&&(this.instanceSelectHandler=jQuery.fn.typeahead.Constructor.prototype.select,this.select=function(n){this.$menu.find(".active").addClass(n.selectedClass),n.instanceSelectHandler.apply(this,arguments)})}return n}(),r=function(){function n(n,t,i){return(this.tagToManipulate="",n.length<1)?n:(this.setContext(n,i),this.initialize(t,i),this.processTags())}return n.prototype.initialize=function(n){this.tagManagerOptions=new t,this.tagManagerOptions.typeaheadOverrides=new i,this.setOptions(n),this.tagManagerOptions.hiddenTagListName===null&&(this.tagManagerOptions.hiddenTagListName="hidden-"+this.obj.attr("name")),this.queuedTag="",this.delimeters=this.tagManagerOptions.delimeters,this.backspace=this.tagManagerOptions.backspace},n.prototype.setupTypeahead=function(){var t,i,n;this.obj.typeahead&&(this.tagManagerOptions.typeaheadSource&&jQuery.isFunction(this.tagManagerOptions.typeaheadSource)?this.obj.typeahead({source:this.tagManagerOptions.typeaheadSource}):this.tagManagerOptions.typeaheadSource?(this.obj.typeahead(),this.setTypeaheadSource(this.tagManagerOptions.typeaheadSource)):this.tagManagerOptions.typeaheadAjaxSource?this.tagManagerOptions.typeaheadAjaxPolling?this.tagManagerOptions.typeaheadAjaxPolling&&this.obj.typeahead({source:jQuery.proxy(this.ajaxPolling,this)}):(this.obj.typeahead(),t=jQuery.proxy(this.onTypeaheadAjaxSuccess,this),typeof this.tagManagerOptions.typeaheadAjaxSource=="string"&&(i=this.tagManagerOptions.typeaheadAjaxSource,jQuery.ajax({cache:!1,type:"POST",contentType:"application/json",dataType:"json",url:i,data:JSON.stringify({typeahead:""}),success:function(n){t(n,!0)}}))):this.tagManagerOptions.typeaheadDelegate&&this.obj.typeahead(this.tagManagerOptions.typeaheadDelegate),n=this.obj.data("typeahead"),n&&(n.select=jQuery.proxy(this.tagManagerOptions.typeaheadOverrides.select,this.obj.data("typeahead"),this.tagManagerOptions.typeaheadOverrides)))},n.prototype.onTypeaheadAjaxSuccess=function(n,t,i){var u=t?this:null,r;"d"in n&&(n=n.d),n&&n.tags&&(r=[],r.length=0,jQuery.each(n.tags,function(n,i){r.push(i.tag),t&&u.setTypeaheadSource(r)}),jQuery.isFunction(i)&&i(r))},n.prototype.setTypeaheadSource=function(n){this.obj.data("active",!0),this.obj.data("typeahead").source=n,this.obj.data("active",!1)},n.prototype.ajaxPolling=function(n,t){var r=jQuery.proxy(this.onTypeaheadAjaxSuccess,this),i;typeof this.tagManagerOptions.typeaheadAjaxSource=="string"&&(i=this.tagManagerOptions.typeaheadAjaxSource,jQuery.ajax({cache:!1,type:"POST",contentType:"application/json",dataType:"json",url:i,data:JSON.stringify({typeahead:n}),success:function(n){r(n,!1,t)}}))},n.prototype.trimTag=function(n){for(var i=jQuery.trim(n),r=i.length,u=0,t=r-1;t>=0;t--){if(-1==jQuery.inArray(i.charCodeAt(t),this.delimeters))break;u++}for(i=i.substring(0,r-u),r=i.length,u=0,t=0;t<r;t++){if(-1==jQuery.inArray(i.charCodeAt(t),this.delimeters))break;u++}return i.substring(u,r)},n.prototype.popTag=function(){var i=this.obj.data("tlis"),n=this.obj.data("tlid"),t;n.length>0&&(t=n.pop(),i.pop(),jQuery("#"+this.objName+"_"+t).remove(),this.refreshHiddenTagList())},n.prototype.empty=function(){for(var i=this.obj.data("tlis"),n=this.obj.data("tlid"),t;n.length>0;)t=n.pop(),i.pop(),jQuery("#"+this.objName+"_"+t).remove(),this.refreshHiddenTagList()},n.prototype.refreshHiddenTagList=function(){var t=this.obj.data("tlis"),n=this.obj.data("lhiddenTagList");n!=undefined&&jQuery(n).val(t.join(",")).change()},n.prototype.spliceTag=function(n){var i=this.obj.data("tlis"),r=this.obj.data("tlid"),t=jQuery.inArray(n,r);-1!=t&&(jQuery("#"+this.objName+"_"+n).remove(),i.splice(t,1),r.splice(t,1),this.refreshHiddenTagList()),this.tagManagerOptions.maxTags>0&&i.length<this.tagManagerOptions.maxTags&&this.obj.show()},n.prototype.pushTag=function(n,t,i){var s,r,e,l,u,f;if(n&&i&&!(n.length<=0)&&(s=this,this.tagManagerOptions.CapitalizeFirstLetter&&n.length>1&&(n=n.charAt(0).toUpperCase()+n.slice(1).toLowerCase()),!jQuery.isFunction(this.tagManagerOptions.validator)||this.tagManagerOptions.validator(n))&&(r=this.obj.data("tlis"),e=this.obj.data("tlid"),!(this.tagManagerOptions.maxTags>0)||!(r.length>=this.tagManagerOptions.maxTags))){var h=!1,v=r.map(function(n){return n.toLowerCase()}),c=jQuery.inArray(n.toLowerCase(),v);if(-1!=c&&(h=!0),h)l=e[c],jQuery("#"+this.objName+"_"+l).stop().animate({backgroundColor:this.tagManagerOptions.blinkBGColor_1},100).animate({backgroundColor:this.tagManagerOptions.blinkBGColor_2},100).animate({backgroundColor:this.tagManagerOptions.blinkBGColor_1},100).animate({backgroundColor:this.tagManagerOptions.blinkBGColor_2},100).animate({backgroundColor:this.tagManagerOptions.blinkBGColor_1},100).animate({backgroundColor:this.tagManagerOptions.blinkBGColor_2},100);else{u=Math.max.apply(null,e),u=u==-Infinity?0:u,f=++u,r.push(n),e.push(f),this.tagManagerOptions.AjaxPush&&jQuery.post(this.tagManagerOptions.AjaxPush,{tag:n});var y=this.objName+"_"+f,a=this.objName+"_Remover_"+f,o="",p=this.tagManagerOptions.tagClass?" "+this.tagManagerOptions.tagClass:"";o+='<span class="myTag'+p+'" id="'+y+'"><span>'+n+'&nbsp;&nbsp;<\/span><a href="#" class="myTagRemover" id="'+a+'" TagIdToRemove="'+f+'" title="Remove">'+this.tagManagerOptions.tagCloseIcon+"<\/a><\/span> ",this.tagManagerOptions.tagsContainer?jQuery(this.tagManagerOptions.tagsContainer).append(o):this.obj.before(o);jQuery("#"+a).on("click",this.obj,function(n){n.preventDefault();var t=parseInt(jQuery(this).attr("TagIdToRemove"));s.spliceTag(t,n.data)});this.refreshHiddenTagList(),this.tagManagerOptions.maxTags>0&&r.length>=this.tagManagerOptions.maxTags&&this.obj.hide()}this.obj.val("")}},n.prototype.setOptions=function(n){n&&jQuery.extend(!0,this.tagManagerOptions,n)},n.prototype.setContext=function(n,t){this.obj=n,this.objName=this.obj.attr("name").replace(/[^\w]/g,"_"),this.tagToManipulate=t},n.prototype.processCommand=function(n,t,i){return n.length>0?this.processTags(t,n,i):n},n.prototype.processTags=function(n,t,i){var r=this;return this.obj.each(function(){var u=!1,f=!1,h,c,o,s,e;if(typeof n=="string"){switch(n){case"empty":r.setContext(t,i),r.empty();break;case"popTag":r.setContext(t,i),r.popTag();break;case"pushTag":r.setContext(t,i),r.pushTag(r.tagToManipulate,null,!0)}return}jQuery(this).data("tagsmanager",jQuery.proxy(r.processCommand,r)),h=[],c=[],r.obj.data("tlis",h),r.obj.data("tlid",c),r.tagManagerOptions.hiddenTagListId==null?(o=$("input[name="+r.tagManagerOptions.hiddenTagListName+"]"),o.length>0&&o.remove(),s="",s+="<input name='"+r.tagManagerOptions.hiddenTagListName+"' type='hidden' value=''/>",r.obj.after(s),r.obj.data("lhiddenTagList",r.obj.siblings("input[name='"+r.tagManagerOptions.hiddenTagListName+"']")[0])):r.obj.data("lhiddenTagList",jQuery("#"+r.tagManagerOptions.hiddenTagListId)),r.tagManagerOptions.typeahead&&r.setupTypeahead();r.obj.on("focus",function(){jQuery(this).popover&&jQuery(this).popover("hide")});if(r.tagManagerOptions.isClearInputOnEsc)r.obj.on("keyup",function(n){n.which==27&&(jQuery(this).val(""),n.cancelBubble=!0,n.returnValue=!1,n.stopPropagation(),n.preventDefault())});r.obj.on("keypress",function(n){var i,t;jQuery(this).popover&&jQuery(this).popover("hide"),r.tagManagerOptions.preventSubmitOnEnter&&n.which==13&&(n.cancelBubble=!0,n.returnValue=!1,n.stopPropagation(),n.preventDefault()),i=jQuery.inArray(n.which,r.delimeters),-1!=i?(u=!0,t=jQuery(this).val(),t=r.trimTag(t),r.pushTag(t,n.data,u),n.preventDefault()):u=!1});if(r.tagManagerOptions.deleteTagsOnBackspace)r.obj.on("keydown",r.obj,function(n){var u=jQuery.inArray(n.which,r.backspace),t,i;-1!=u&&(t=jQuery(this).val(),i=t.length,i<=0&&(n.preventDefault(),r.popTag()))});if(r.obj.change(function(n){var s,o,t;n.cancelBubble=!0,n.returnValue=!1,n.stopPropagation(),n.preventDefault();var i=r.tagManagerOptions.typeaheadOverrides.selectedClass,e="."+i,h=$(this).data("typeahead");if(h&&(f=$(this).data("typeahead").$menu.find("*").filter(e).hasClass(i),f&&(u=!0)),u){var c=navigator.userAgent.indexOf("Chrome")>-1,a=navigator.userAgent.indexOf("MSIE")>-1,v=navigator.userAgent.indexOf("Firefox")>-1,l=navigator.userAgent.indexOf("Safari")>-1;c||l||jQuery(this).focus(),s=jQuery(".typeahead:visible"),s[0]?(o=!f,f&&(t=$(this).data("typeahead").$menu.find(e).attr("data-value"),t=r.trimTag(t),r.queuedTag==jQuery(this).val()&&r.queuedTag==t?o=!0:(r.pushTag(t,null,!0),r.queuedTag=t),f=!1,$(this).data("typeahead").$menu.find(e).removeClass(i)),o&&(r.queuedTag="",jQuery(this).val(r.queuedTag))):(t=jQuery(this).val(),t=r.trimTag(t),r.pushTag(t,null,!0)),u=!1}}),!0||!r.tagManagerOptions.typeahead)r.obj.on("blur",function(n){var i,f,t;n.cancelBubble=!0,n.returnValue=!1,n.stopPropagation(),n.preventDefault(),i=!0,r.tagManagerOptions.typeahead&&(f=jQuery(".typeahead:visible"),i=f[0]?!1:!0),i&&(t=jQuery(this).val(),t=r.trimTag(t),r.pushTag(t,null,u))});r.tagManagerOptions.prefilled&&(typeof r.tagManagerOptions.prefilled=="object"?(e=r.tagManagerOptions.prefilled,jQuery.each(e,function(n,t){r.pushTag(t,r.obj,!0)})):typeof r.tagManagerOptions.prefilled=="string"&&(e=r.tagManagerOptions.prefilled.split(","),jQuery.each(e,function(n,t){r.pushTag(t,r.obj,!0)})))})},n}();n.TagsManager=r})(Tags||(Tags={})),function(n){n.fn.tagsManager=function(t,i){if(typeof t=="string"){var r=this.filter("html");return this.each(function(){var u=n(this),f=u.data("tagsmanager"),e=f(u,t,i);r.add(e)}),r}return new Tags.TagsManager(this,t,i)}}(jQuery)